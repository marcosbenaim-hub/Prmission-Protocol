<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Prmission Protocol ‚Äî Live Demo</title>
<style>
*{box-sizing:border-box;margin:0;padding:0;scrollbar-width:none;-ms-overflow-style:none}
*::-webkit-scrollbar{display:none}
body{background:#0d0f14;min-height:100vh;display:flex;align-items:center;justify-content:center;font-family:-apple-system,BlinkMacSystemFont,'SF Pro Display',system-ui,sans-serif;padding:16px}
@keyframes pulse{0%,100%{opacity:1}50%{opacity:.4}}
@keyframes shimmer{0%{transform:translateX(-100%)}100%{transform:translateX(100%)}}
@keyframes blink{0%,100%{opacity:1}50%{opacity:0}}
@keyframes fadeIn{from{opacity:0;transform:translateY(8px)}to{opacity:1;transform:translateY(0)}}
@keyframes slideDown{from{opacity:0;transform:translateY(-20px)}to{opacity:1;transform:translateY(0)}}
@keyframes npulse{0%,100%{box-shadow:0 4px 24px rgba(0,229,160,.2)}50%{box-shadow:0 4px 32px rgba(0,229,160,.5)}}
</style>
</head>
<body>
<div id="root"></div>
<script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
<script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
<script crossorigin src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
<script type="text/babel">
const {useState,useEffect,useRef}=React;
const G="#00E5A0",BG="#0a0e17",CD="#111827",BD="#1e293b",DM="#ffffff",TX="#e2e8f0",RD="#FF4444";
const mn="ui-monospace,'SF Mono','Cascadia Code',monospace";
const sn="-apple-system,BlinkMacSystemFont,'SF Pro Display',system-ui,sans-serif";
const STEPS=[
  {fn:"grantPermission()",d:"User defines access terms & fee"},
  {fn:"depositEscrow()",d:"Agent deposits $25.00 USDC"},
  {fn:"reportOutcome()",d:"Outcome value: $500.00"},
  {fn:"disputeSettlement()",d:"24hr window ‚Äî no disputes"},
  {fn:"settle()",d:"Fees distributed on-chain"},
];
const WTX=[
  {a:"TravelBot v3.2",m:12.5,t:"2h ago",i:"‚úàÔ∏è",tr:94,r:false},
  {a:"HealthSync",m:15.0,t:"3h ago",i:"ü©∫",tr:87,r:false},
  {a:"DineAI",m:8.4,t:"5h ago",i:"üçΩÔ∏è",tr:91,r:false},
  {a:"ShopAgent",m:5.2,t:"8h ago",i:"üõí",tr:78,r:false},
  {a:"SocialPulse",m:6.8,t:"1d ago",i:"üì±",tr:82,r:true},
  {a:"StreamMatch",m:3.5,t:"1d ago",i:"üé¨",tr:89,r:true},
  {a:"CarrierIQ",m:5.0,t:"2d ago",i:"üì∂",tr:76,r:true},
];
const CATS=[
  {id:"travel",i:"‚úàÔ∏è",l:"Travel",f:2},
  {id:"health",i:"ü©∫",l:"Health",f:5},
  {id:"food",i:"üçΩÔ∏è",l:"Dining",f:1},
  {id:"social",i:"üì±",l:"Social Media",f:2},
  {id:"streaming",i:"üé¨",l:"Streaming",f:1},
  {id:"phone",i:"üì∂",l:"Phone Carrier",f:1},
  {id:"creditcard",i:"üí≥",l:"Credit Card",f:3},
];
const DLS=[
  {a:"DineAI",i:"üçΩÔ∏è",d:"Dining",tr:91},
  {a:"TravelBot v3.2",i:"‚úàÔ∏è",d:"Travel",tr:94},
  {a:"HealthSync",i:"ü©∫",d:"Health",tr:87},
  {a:"SocialPulse",i:"üì±",d:"Social Media",tr:82},
  {a:"StreamMatch",i:"üé¨",d:"Streaming",tr:89},
  {a:"CarrierIQ",i:"üì∂",d:"Phone Carrier",tr:76},
  {a:"RewardBot",i:"üí≥",d:"Credit Card",tr:90},
  {a:"ShopAgent",i:"üõí",d:"Dining",tr:78},
];
const ETX=[
  {a:"HealthSync",m:15.0,i:"ü©∫",pf:0.45},
  {a:"TravelBot v3.2",m:12.5,i:"‚úàÔ∏è",pf:0.38},
  {a:"DineAI",m:8.4,i:"üçΩÔ∏è",pf:0.25},
  {a:"ShopAgent",m:5.2,i:"üõí",pf:0.15},
];
const ATX=[
  {a:"TravelBot v3.2",m:12.5,t:"2h ago",i:"‚úàÔ∏è",r:false},
  {a:"HealthSync",m:15.0,t:"3h ago",i:"ü©∫",r:false},
  {a:"DineAI",m:8.4,t:"5h ago",i:"üçΩÔ∏è",r:false},
  {a:"ShopAgent",m:5.2,t:"8h ago",i:"üõí",r:false},
  {a:"SocialPulse",m:6.8,t:"1d ago",i:"üì±",r:true},
  {a:"StreamMatch",m:3.5,t:"2d ago",i:"üé¨",r:true},
  {a:"CarrierIQ",m:5.0,t:"2d ago",i:"üì∂",r:true},
];
const MSG="TravelBot v3.2 wants access to your Travel Preferences for flight booking optimization. Outcome value: $500.00 USDC. Your fee: 2% ($10.00).";
const CMP={Travel:"travel",Health:"health",Dining:"food","Social Media":"social",Streaming:"streaming","Phone Carrier":"phone","Credit Card":"creditcard"};
const DAMT={Travel:2.50,Health:5.00,Dining:1.20,"Social Media":2.00,Streaming:1.00,"Phone Carrier":1.00,"Credit Card":3.00};

function App(){
  const[vw,setVw]=useState("home");
  const[pm,setPm]=useState({travel:false,food:false,health:false,social:false,streaming:false,phone:false,creditcard:false});
  const[st,setSt]=useState(-1);
  const[ea,setEa]=useState(41.10);
  const[nf,setNf]=useState(false);
  const[tp,setTp]=useState("");
  const[dm,setDm]=useState(false);
  const[pa,setPa]=useState(false);
  const[sd,setSd]=useState(false);
  const[vd,setVd]=useState([]);
  const[pr,setPr]=useState(1.23);
  const[sc,setSc]=useState(4);
  const[ws,setWs]=useState("idle");
  const[wa,setWa]=useState(0);
  const[dealing,setDealing]=useState(false);
  const tr=useRef([]);
  const dealRef=useRef(null);
  const pmRef=useRef(pm);
  pmRef.current=pm;

  useEffect(()=>{
    if(st!==0||!dm||pa)return;
    let x=0;setTp("");
    const iv=setInterval(()=>{if(x<MSG.length){x++;setTp(MSG.slice(0,x))}else clearInterval(iv)},18);
    return()=>clearInterval(iv);
  },[st,dm,pa]);

  useEffect(()=>{
    if(!dealing||pa){if(dealRef.current)clearTimeout(dealRef.current);return}
    let idx=0,speed=2000;
    const tick=()=>{
      const dl=DLS[idx%DLS.length];
      const cid=CMP[dl.d];
      const isOn=pmRef.current[cid];
      const amt=DAMT[dl.d];
      const pFee=+(amt*0.03).toFixed(2);
      setVd(p=>[{...dl,rv:!isOn,amt},...p].slice(0,50));
      if(isOn){
        setEa(x=>+(x+amt).toFixed(2));
        setPr(x=>+(x+pFee).toFixed(2));
        setSc(x=>x+1);
      }
      idx++;
      speed=Math.max(50,Math.floor(speed*0.85));
      dealRef.current=setTimeout(tick,speed);
    };
    dealRef.current=setTimeout(tick,speed);
    return()=>{if(dealRef.current)clearTimeout(dealRef.current)};
  },[dealing,pa]);

  const clr=()=>{tr.current.forEach(clearTimeout);tr.current=[]};
  const tm=(fn,ms)=>{tr.current.push(setTimeout(fn,ms))};
  const run=()=>{
    clr();setDm(true);setPa(false);setVw("home");setSt(-1);setSd(false);setTp("");setDealing(false);setVd([]);
    tm(()=>setNf(true),600);
    tm(()=>{setNf(false);setVw("request");setSt(0)},2600);
    tm(()=>setSt(1),5200);
    tm(()=>setSt(2),7200);
    tm(()=>setSt(3),9200);
    tm(()=>{setSt(4);setSd(true);setEa(x=>+(x+10).toFixed(2));setPr(x=>+(x+0.30).toFixed(2));setSc(x=>x+1)},11200);
    tm(()=>{setVw("home");setSt(-1);setDm(false);setDealing(true)},14000);
  };
  const stop=()=>{clr();setDm(false);setPa(false);setSt(-1);setSd(false);setTp("");setNf(false);setVw("home");setDealing(false);setVd([])};
  const reset=()=>{stop();setEa(41.10);setPr(1.23);setSc(4);setPm({travel:false,food:false,health:false,social:false,streaming:false,phone:false,creditcard:false})};
  const cv=vw==="request"?"home":vw;
  const tc=t=>t>=90?G:t>=80?"#FFD700":"#FF8C00";
  const active=dm||dealing;

  // Auto-play: enable all toggles + start demo after 2 seconds
  const autoStarted=useRef(false);
  useEffect(()=>{
    if(autoStarted.current)return;
    autoStarted.current=true;
    setTimeout(()=>{
      setPm({travel:true,food:true,health:true,social:true,streaming:true,phone:true,creditcard:true});
      setTimeout(()=>run(),500);
    },2000);
  },[]);

  const DealFeed=()=>vd.length>0?(
    <div style={{marginBottom:8}}>
      <div style={{fontSize:9,fontFamily:mn,color:G,letterSpacing:1,textTransform:"uppercase",marginBottom:6,display:"flex",alignItems:"center",gap:6}}>
        <div style={{width:5,height:5,borderRadius:"50%",background:G,boxShadow:"0 0 6px "+G,animation:"pulse 1s ease-in-out infinite"}}/>Live Settlements
      </div>
      {vd.map((d,i)=>(
        <div key={i} style={{display:"flex",alignItems:"center",gap:8,padding:"5px 10px",background:d.rv?RD+"08":G+"08",border:"1px solid "+(d.rv?RD+"20":G+"20"),borderRadius:8,marginBottom:3}}>
          <span style={{fontSize:14,opacity:d.rv?.5:1}}>{d.i}</span>
          <div style={{flex:1}}>
            <div style={{fontSize:10,fontWeight:600,color:d.rv?DM:TX}}>{d.a}</div>
            <div style={{fontSize:7,color:d.rv?RD:DM,fontFamily:mn}}>{d.rv?"REVOKED":"+$"+d.amt.toFixed(2)}</div>
          </div>
          <div style={{fontSize:10,fontWeight:700,color:d.rv?RD:G,fontFamily:mn,textDecoration:d.rv?"line-through":"none"}}>{"$"+d.amt.toFixed(2)}</div>
        </div>
      ))}
    </div>
  ):null;

  return(
    <div style={{display:"flex",flexWrap:"wrap",alignItems:"flex-start",justifyContent:"center",gap:24,maxWidth:700}}>
      <div style={{display:"flex",flexDirection:"column",alignItems:"center",gap:12}}>
        <div style={{fontSize:14,fontWeight:800,color:G,fontFamily:mn,letterSpacing:2}}>PRMISSION</div>
        <div style={{fontSize:10,color:DM,fontFamily:mn,marginTop:-8}}>The economic layer for AI agent commerce</div>
        <div style={{width:300,height:600,borderRadius:36,background:"#000",padding:3,boxShadow:"0 0 0 2px #333,0 20px 60px rgba(0,0,0,.6)"}}>
          <div style={{width:"100%",height:"100%",borderRadius:33,background:BG,overflow:"hidden",display:"flex",flexDirection:"column",position:"relative"}}>
            <div style={{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"6px 20px 2px",fontSize:12,fontWeight:600,color:TX,position:"relative"}}>
              <span>9:41</span>
              <div style={{position:"absolute",left:"50%",top:4,transform:"translateX(-50%)",width:72,height:22,background:"#000",borderRadius:11}}/>
              <span style={{fontSize:10}}>üîã</span>
            </div>
            {nf&&(
              <div style={{position:"absolute",top:34,left:8,right:8,zIndex:100,background:"#1a2332ee",border:"1px solid "+G+"40",borderRadius:12,padding:"8px 10px",animation:"slideDown .3s ease,npulse 1.5s ease-in-out infinite",display:"flex",alignItems:"center",gap:8}}>
                <div style={{width:28,height:28,borderRadius:7,background:G+"20",display:"flex",alignItems:"center",justifyContent:"center",fontSize:14}}>‚úàÔ∏è</div>
                <div style={{flex:1}}><div style={{fontSize:10,fontWeight:700,color:TX}}>TravelBot v3.2</div><div style={{fontSize:8,color:DM}}>Requesting Travel data...</div></div>
                <div style={{fontSize:8,color:G,fontFamily:mn}}>now</div>
              </div>
            )}
            <div style={{padding:"10px 16px 8px",display:"flex",alignItems:"center",justifyContent:"space-between"}}>
              <span style={{fontSize:17,fontWeight:700,color:TX}}>{vw==="home"?"Wallet":vw==="request"?"Permission Request":vw==="locker"?"Data Locker":vw==="earnings"?"Earnings":"Activity"}</span>
              <span style={{fontSize:13,fontWeight:800,color:G,fontFamily:mn}}>Prmission</span>
            </div>

            {vw==="home"&&(
              <div style={{flex:1,overflowY:"auto",padding:"0 14px 14px"}}>
                <div style={{textAlign:"center",padding:"14px 0"}}>
                  <div style={{fontSize:9,fontFamily:mn,color:DM,letterSpacing:1.5,textTransform:"uppercase",marginBottom:2}}>Total Earned</div>
                  <div style={{fontSize:36,fontWeight:800,color:TX,lineHeight:1,transition:"all .3s"}}>{"$"+ea.toFixed(2)}</div>
                  <div style={{fontSize:10,color:G,fontFamily:mn,marginTop:3}}>USDC on Base</div>
                </div>
                <div style={{display:"flex",gap:6,marginBottom:12}}>
                  {[{l:"LIVE",s:"Base Mainnet"},{l:"3%",s:"Protocol Fee"},{l:"~3s",s:"Settlement"}].map((x,i)=>(
                    <div key={i} style={{flex:1,background:CD,border:"1px solid "+BD,borderRadius:8,padding:"7px 4px",textAlign:"center"}}>
                      <div style={{fontSize:12,fontWeight:800,color:G,fontFamily:mn}}>{x.l}</div>
                      <div style={{fontSize:7,color:"#fff",fontFamily:mn,marginTop:1,letterSpacing:.5,textTransform:"uppercase"}}>{x.s}</div>
                    </div>
                  ))}
                </div>
                {dealing&&<DealFeed/>}
                {!dealing&&(
                  <>
                    <div style={{fontSize:9,fontFamily:mn,color:DM,letterSpacing:1,textTransform:"uppercase",marginBottom:6}}>Recent Settlements</div>
                    {WTX.map((tx,i)=>(
                      <div key={i} style={{display:"flex",alignItems:"center",gap:10,padding:"8px 10px",background:tx.r?RD+"08":CD,border:"1px solid "+(tx.r?RD+"20":BD),borderRadius:8,marginBottom:4}}>
                        <span style={{fontSize:16,opacity:tx.r?.5:1}}>{tx.i}</span>
                        <div style={{flex:1}}>
                          <div style={{fontSize:11,fontWeight:600,color:tx.r?DM:TX}}>{tx.a}</div>
                          <div style={{display:"flex",alignItems:"center",gap:4}}>
                            <div style={{width:36,height:3,borderRadius:2,background:BD,overflow:"hidden"}}><div style={{width:tx.tr+"%",height:"100%",background:tc(tx.tr),borderRadius:2}}/></div>
                            <span style={{fontSize:8,color:tc(tx.tr),fontFamily:mn}}>{tx.tr}</span>
                            <span style={{fontSize:7,color:DM,fontFamily:mn}}>ERC-8004</span>
                          </div>
                        </div>
                        <div style={{textAlign:"right"}}>
                          <div style={{fontSize:11,fontWeight:700,color:tx.r?RD:G,fontFamily:mn}}>{(tx.r?"‚úò":"+")+(" $"+tx.m.toFixed(2))}</div>
                          <div style={{fontSize:7,color:tx.r?RD:DM,fontFamily:mn}}>{tx.r?"REVOKED":"USDC"}</div>
                        </div>
                      </div>
                    ))}
                  </>
                )}
                <div style={{marginTop:8,padding:"7px 10px",background:G+"08",border:"1px solid "+G+"20",borderRadius:8,display:"flex",alignItems:"center",gap:6}}>
                  <div style={{width:5,height:5,borderRadius:"50%",background:G,boxShadow:"0 0 6px "+G,animation:"pulse 2s ease-in-out infinite"}}/>
                  <span style={{fontSize:8,fontFamily:mn,color:G+"bb"}}>Live on Base Mainnet ¬∑ 0x0c8B...223d</span>
                </div>
              </div>
            )}

            {vw==="request"&&(
              <div style={{flex:1,overflowY:"auto",padding:"0 14px 14px"}}>
                <div style={{textAlign:"center",padding:"10px 0"}}>
                  <div style={{width:40,height:40,borderRadius:10,background:G+"15",border:"1px solid "+G+"30",display:"flex",alignItems:"center",justifyContent:"center",margin:"0 auto 6px",fontSize:20}}>‚úàÔ∏è</div>
                  <div style={{fontSize:13,fontWeight:700,color:TX}}>TravelBot v3.2</div>
                  <div style={{fontSize:8,color:DM,fontFamily:mn,marginTop:2}}>Trust: 94 ¬∑ ERC-8004</div>
                </div>
                <div style={{background:CD,border:"1px solid "+BD,borderRadius:10,padding:12,marginBottom:8}}>
                  <div style={{fontSize:9,fontFamily:mn,color:DM,letterSpacing:1,textTransform:"uppercase",marginBottom:6}}>Permission Request</div>
                  <div style={{fontSize:11,color:TX,lineHeight:1.5,minHeight:40}}>
                    {tp||<span style={{color:DM}}>Loading request...</span>}
                    {tp.length<MSG.length&&tp.length>0&&<span style={{display:"inline-block",width:2,height:12,background:G,marginLeft:1,animation:"blink .8s step-end infinite"}}/>}
                  </div>
                </div>
                <div style={{background:CD,border:"1px solid "+BD,borderRadius:10,padding:10,marginBottom:8}}>
                  <div style={{fontSize:9,fontFamily:mn,color:DM,letterSpacing:1,textTransform:"uppercase",marginBottom:6}}>Fee Breakdown</div>
                  {[{l:"User (2%)",v:"$10.00",c:G},{l:"Protocol (3%)",v:"$0.30",c:G},{l:"Agent pays",v:"$10.30",c:TX}].map((r,i)=>(
                    <div key={i} style={{display:"flex",justifyContent:"space-between",padding:"3px 0",borderBottom:i<2?"1px solid "+BD:"none"}}>
                      <span style={{fontSize:10,color:DM,fontFamily:mn}}>{r.l}</span>
                      <span style={{fontSize:10,color:r.c,fontFamily:mn,fontWeight:600}}>{r.v}</span>
                    </div>
                  ))}
                </div>
                <div style={{display:"flex",flexDirection:"column",gap:4,marginBottom:10}}>
                  {STEPS.map((s,i)=>(
                    <div key={i} style={{display:"flex",alignItems:"center",gap:8,padding:"7px 10px",background:st>i?G+"12":st===i?G+"08":CD,border:"1px solid "+(st>i?G+"40":st===i?G+"30":BD),borderRadius:8,transition:"all .5s",position:"relative",overflow:"hidden"}}>
                      {st===i&&<div style={{position:"absolute",top:0,left:0,right:0,height:2,background:"linear-gradient(90deg,transparent,"+G+",transparent)",animation:"shimmer 1.5s linear infinite"}}/>}
                      <div style={{width:18,height:18,borderRadius:9,background:st>i?G:st===i?G+"25":BD,display:"flex",alignItems:"center",justifyContent:"center",fontSize:9,fontWeight:800,color:st>i?BG:st===i?G:DM}}>{st>i?"‚úì":i+1}</div>
                      <div style={{flex:1}}>
                        <div style={{fontSize:8,fontFamily:mn,color:st>=i?G:DM,fontWeight:600}}>{s.fn}</div>
                        <div style={{fontSize:9,color:st===i?TX:DM}}>{s.d}</div>
                      </div>
                      {st===i&&<div style={{width:5,height:5,borderRadius:"50%",background:G,boxShadow:"0 0 6px "+G,animation:"pulse 1.5s ease-in-out infinite"}}/>}
                    </div>
                  ))}
                </div>
                {sd&&(
                  <div style={{background:G+"15",border:"1px solid "+G+"40",borderRadius:10,padding:12,textAlign:"center",animation:"fadeIn .5s ease"}}>
                    <div style={{fontSize:20,marginBottom:4}}>‚úÖ</div>
                    <div style={{fontSize:13,fontWeight:700,color:G}}>Settlement Complete</div>
                    <div style={{fontSize:10,color:TX,fontFamily:mn,marginTop:2}}>+$10.00 USDC credited</div>
                  </div>
                )}
              </div>
            )}

            {vw==="locker"&&(
              <div style={{flex:1,overflowY:"auto",padding:"0 14px 14px"}}>
                <div style={{fontSize:9,fontFamily:mn,color:DM,letterSpacing:1,textTransform:"uppercase",marginBottom:6}}>Data Locker</div>
                <div style={{display:"grid",gridTemplateColumns:"1fr 1fr",gap:6}}>
                  {CATS.map(c=>{
                    const on=pm[c.id];
                    return(
                      <button key={c.id} onClick={()=>setPm(p=>({...p,[c.id]:!p[c.id]}))} style={{background:on?G+"08":CD,border:"1px solid "+(on?G+"30":BD),borderRadius:10,padding:9,cursor:"pointer",textAlign:"left",transition:"all .3s"}}>
                        <div style={{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:5}}>
                          <span style={{fontSize:18}}>{c.i}</span>
                          <div style={{width:32,height:18,borderRadius:9,background:on?G:BD,position:"relative",transition:"all .3s",border:"1px solid "+(on?G+"60":BD)}}>
                            <div style={{width:12,height:12,borderRadius:6,background:on?BG:DM,position:"absolute",top:2,left:on?16:2,transition:"all .3s"}}/>
                          </div>
                        </div>
                        <div style={{fontSize:10,fontWeight:600,color:on?TX:DM,marginBottom:1}}>{c.l}</div>
                        <div style={{fontSize:7,fontFamily:mn,color:on?G:DM}}>{"Fee: "+c.f+"%"}</div>
                      </button>
                    );
                  })}
                </div>
              </div>
            )}

            {vw==="earnings"&&(
              <div style={{flex:1,overflowY:"auto",padding:"0 14px 14px"}}>
                <div style={{textAlign:"center",padding:"14px 0"}}>
                  <div style={{fontSize:9,fontFamily:mn,color:DM,letterSpacing:1.5,textTransform:"uppercase",marginBottom:2}}>Available to Withdraw</div>
                  <div style={{fontSize:36,fontWeight:800,color:G,lineHeight:1,transition:"all .3s"}}>{"$"+ea.toFixed(2)}</div>
                  <div style={{fontSize:10,color:DM,fontFamily:mn,marginTop:3}}>USDC on Base</div>
                </div>
                {ws!=="idle"&&(
                  <div style={{background:CD,border:"1px solid "+(ws==="done"?G+"40":BD),borderRadius:12,padding:14,marginBottom:10,animation:"fadeIn .4s ease"}}>
                    <div style={{display:"flex",alignItems:"center",justifyContent:"center",gap:10,marginBottom:10}}>
                      {[{lb:"USDC",cl:"#2775CA",ac:ws==="converting"},{lb:"USD",cl:G,ac:ws==="depositing"||ws==="done"},{lb:"Bank",cl:G,ac:ws==="done",em:"üè¶"}].map((s,i)=>(
                        <div key={i} style={{display:"flex",alignItems:"center",gap:6}}>
                          <div style={{textAlign:"center",opacity:s.ac?1:.3,transition:"all .5s"}}>
                            <div style={{width:32,height:32,borderRadius:16,background:s.cl+"15",border:"1px solid "+s.cl+"40",display:"flex",alignItems:"center",justifyContent:"center",margin:"0 auto 3px",fontSize:s.em?14:12,fontWeight:800,color:s.cl,fontFamily:mn}}>{s.em||"$"}</div>
                            <div style={{fontSize:7,color:s.cl,fontFamily:mn}}>{s.lb}</div>
                          </div>
                          {i<2&&<div style={{fontSize:12,color:DM,marginTop:-10}}>‚Üí</div>}
                        </div>
                      ))}
                    </div>
                    <div style={{textAlign:"center"}}>
                      {ws==="converting"&&<div style={{fontSize:10,color:"#2775CA",fontFamily:mn,animation:"pulse 1s ease-in-out infinite"}}>{"Converting $"+wa.toFixed(2)+" USDC ‚Üí USD..."}</div>}
                      {ws==="depositing"&&<div style={{fontSize:10,color:G,fontFamily:mn,animation:"pulse 1s ease-in-out infinite"}}>{"Depositing $"+wa.toFixed(2)+" to bank..."}</div>}
                      {ws==="done"&&<div style={{animation:"fadeIn .4s ease"}}><div style={{fontSize:16,marginBottom:3}}>‚úÖ</div><div style={{fontSize:12,fontWeight:700,color:G}}>Deposit Confirmed</div><div style={{fontSize:9,color:TX,fontFamily:mn,marginTop:2}}>{"$"+wa.toFixed(2)+" USD deposited instantly"}</div></div>}
                    </div>
                  </div>
                )}
                {ws==="idle"&&ea>0&&(
                  <button onClick={()=>{setWa(ea);setWs("converting");setTimeout(()=>setWs("depositing"),1800);setTimeout(()=>{setWs("done");setEa(0)},3600);setTimeout(()=>setWs("idle"),6000)}} style={{width:"100%",padding:11,background:G,color:BG,border:"none",borderRadius:10,fontSize:12,fontWeight:700,fontFamily:mn,cursor:"pointer",marginBottom:10,boxShadow:"0 4px 16px "+G+"40"}}>
                    {"WITHDRAW $"+ea.toFixed(2)+" ‚Üí BANK"}
                  </button>
                )}
                <div style={{fontSize:9,fontFamily:mn,color:DM,letterSpacing:1,textTransform:"uppercase",marginBottom:6}}>Earnings by Agent</div>
                {ETX.map((tx,i)=>(
                  <div key={i} style={{display:"flex",alignItems:"center",gap:10,padding:"8px 10px",background:CD,border:"1px solid "+BD,borderRadius:8,marginBottom:4}}>
                    <span style={{fontSize:16}}>{tx.i}</span>
                    <div style={{flex:1}}>
                      <div style={{fontSize:11,fontWeight:600,color:TX}}>{tx.a}</div>
                      <div style={{fontSize:7,color:DM,fontFamily:mn}}>{"Protocol 3%: $"+tx.pf.toFixed(2)}</div>
                    </div>
                    <div style={{fontSize:12,fontWeight:700,color:G,fontFamily:mn}}>{"+$"+tx.m.toFixed(2)}</div>
                  </div>
                ))}
                <div style={{marginTop:8,padding:"8px 10px",background:CD,border:"1px solid "+BD,borderRadius:8}}>
                  <div style={{display:"flex",justifyContent:"space-between",marginBottom:3}}>
                    <span style={{fontSize:8,color:DM,fontFamily:mn}}>Your earnings (user fees)</span>
                    <span style={{fontSize:8,color:G,fontFamily:mn,fontWeight:700}}>$41.10</span>
                  </div>
                  <div style={{display:"flex",justifyContent:"space-between"}}>
                    <span style={{fontSize:8,color:DM,fontFamily:mn}}>Protocol collected (3%)</span>
                    <span style={{fontSize:8,color:G,fontFamily:mn,fontWeight:700}}>$1.23</span>
                  </div>
                </div>
              </div>
            )}

            {vw==="activity"&&(
              <div style={{flex:1,overflowY:"auto",padding:"0 14px 14px"}}>
                {dealing&&<DealFeed/>}
                <div style={{fontSize:9,fontFamily:mn,color:DM,letterSpacing:1,textTransform:"uppercase",marginBottom:8}}>Settlement History</div>
                {ATX.map((tx,i)=>(
                  <div key={i} style={{padding:9,background:tx.r?RD+"08":CD,border:"1px solid "+(tx.r?RD+"20":BD),borderRadius:8,marginBottom:4}}>
                    <div style={{display:"flex",alignItems:"center",gap:8}}>
                      <span style={{fontSize:14,opacity:tx.r?.5:1}}>{tx.i}</span>
                      <div style={{flex:1}}><div style={{fontSize:11,fontWeight:600,color:tx.r?DM:TX}}>{tx.a}</div><div style={{fontSize:8,color:DM,fontFamily:mn}}>{tx.t}</div></div>
                      <div style={{textAlign:"right"}}>
                        <div style={{fontSize:11,fontWeight:700,color:tx.r?RD:G,fontFamily:mn}}>{(tx.r?"‚úò":"+")+(" $"+tx.m.toFixed(2))}</div>
                        <div style={{fontSize:7,color:tx.r?RD:DM,fontFamily:mn}}>{tx.r?"REVOKED":"USDC"}</div>
                      </div>
                    </div>
                    <div style={{display:"flex",gap:4,marginTop:5}}>
                      {tx.r
                        ?[{t:"Consent ‚úì",c:G},{t:"Escrow ‚úò",c:RD},{t:"Revoked",c:RD}].map((tg,j)=><span key={j} style={{fontSize:7,fontFamily:mn,color:tg.c,background:tg.c+"12",border:"1px solid "+tg.c+"25",borderRadius:4,padding:"2px 5px"}}>{tg.t}</span>)
                        :["Consent ‚úì","Escrow ‚úì","Settled ‚úì"].map((t,j)=><span key={j} style={{fontSize:7,fontFamily:mn,color:G,background:G+"12",border:"1px solid "+G+"25",borderRadius:4,padding:"2px 5px"}}>{t}</span>)
                      }
                    </div>
                  </div>
                ))}
                <div style={{marginTop:8,padding:"8px 10px",background:CD,border:"1px solid "+BD,borderRadius:8,textAlign:"center"}}>
                  <div style={{fontSize:9,fontFamily:mn,color:DM}}>{"Settled: "}<span style={{color:G,fontWeight:700}}>$41.10</span>{" ¬∑ Revoked: "}<span style={{color:RD,fontWeight:700}}>$15.30</span></div>
                </div>
              </div>
            )}

            <div style={{display:"flex",justifyContent:"space-around",padding:"5px 0 8px",borderTop:"1px solid "+BD,background:"#0d111780"}}>
              {[{id:"home",ic:"‚óâ",lb:"Wallet"},{id:"locker",ic:"‚äû",lb:"Data"},{id:"earnings",ic:"$",lb:"Earn"},{id:"activity",ic:"‚áÑ",lb:"Activity"}].map(n=>(
                <button key={n.id} onClick={()=>{if(!dm)setVw(n.id)}} style={{background:"none",border:"none",cursor:"pointer",display:"flex",flexDirection:"column",alignItems:"center",gap:1,padding:"2px 8px"}}>
                  <span style={{fontSize:n.id==="earnings"?16:14,fontWeight:n.id==="earnings"?800:400,color:cv===n.id?G:DM,fontFamily:n.id==="earnings"?mn:sn}}>{n.ic}</span>
                  <span style={{fontSize:7,fontWeight:600,color:cv===n.id?G:DM}}>{n.lb}</span>
                </button>
              ))}
            </div>
            <div style={{display:"flex",justifyContent:"center",paddingBottom:4}}><div style={{width:80,height:4,borderRadius:2,background:"#333"}}/></div>
          </div>
        </div>

        <div style={{display:"flex",gap:6}}>
          <button onClick={()=>setPa(p=>!p)} disabled={!active} style={{border:"none",borderRadius:8,fontFamily:mn,fontWeight:700,cursor:"pointer",padding:"9px 16px",fontSize:11,background:"#A855F7",color:"#000",opacity:active?1:.4,boxShadow:active?"0 4px 20px #A855F740":"none"}}>{pa?"‚ñ∂ Resume":"‚è∏ Pause"}</button>
          <button onClick={run} style={{border:"none",borderRadius:8,fontFamily:mn,fontWeight:700,cursor:"pointer",padding:"9px 22px",fontSize:11,background:active?DM:G,color:BG,boxShadow:active?"none":"0 4px 20px "+G+"40"}}>{active?"RUNNING...":"‚ñ∂ RUN DEMO"}</button>
          <button onClick={stop} disabled={!active} style={{border:"none",borderRadius:8,fontFamily:mn,fontWeight:700,cursor:"pointer",padding:"9px 16px",fontSize:11,background:"#EF4444",color:"#000",opacity:active?1:.4,boxShadow:active?"0 4px 20px #EF444440":"none"}}>‚ñ† Stop</button>
        </div>
        <button onClick={reset} style={{border:"none",borderRadius:8,fontFamily:mn,fontWeight:700,cursor:"pointer",padding:"7px 20px",fontSize:10,background:"#FACC15",color:"#000",boxShadow:"0 4px 20px #FACC1540"}}>‚Üª Reset All</button>
      </div>

      <div style={{width:260,display:"flex",flexDirection:"column",gap:10}}>

        {/* FLOW HEADER */}
        <div style={{background:G+"10",border:"1px solid "+G+"30",borderRadius:12,padding:14,textAlign:"center"}}>
          <div style={{fontSize:11,fontFamily:mn,color:G,letterSpacing:1.5,textTransform:"uppercase",fontWeight:700,marginBottom:4}}>Money Flow</div>
          <div style={{fontSize:9,color:DM,fontFamily:mn,lineHeight:1.5}}>Every settlement splits fees on-chain in real time</div>
        </div>

        {/* USER WALLET BOX */}
        <div style={{background:CD,border:"1px solid "+BD,borderRadius:12,padding:14,position:"relative"}}>
          <div style={{display:"flex",alignItems:"center",gap:8,marginBottom:6}}>
            <div style={{width:28,height:28,borderRadius:14,background:G+"20",border:"1px solid "+G+"40",display:"flex",alignItems:"center",justifyContent:"center",fontSize:14}}>üë§</div>
            <div>
              <div style={{fontSize:10,fontWeight:700,color:TX}}>User Wallet</div>
              <div style={{fontSize:7,color:DM,fontFamily:mn}}>0x7a3F...e91B</div>
            </div>
          </div>
          <div style={{fontSize:26,fontWeight:800,color:G,fontFamily:mn,transition:"all .3s"}}>{"$"+ea.toFixed(2)}</div>
          <div style={{fontSize:8,color:DM,fontFamily:mn,marginTop:2}}>USDC earned from data permissions</div>
        </div>

        {/* ARROW DOWN + 3% SPLIT */}
        <div style={{display:"flex",flexDirection:"column",alignItems:"center",gap:2}}>
          <div style={{width:2,height:16,background:dealing?G:BD,transition:"all .3s",boxShadow:dealing?"0 0 8px "+G:"none"}}/>
          <div style={{background:dealing?G+"20":"transparent",border:"1px solid "+(dealing?G+"50":BD),borderRadius:8,padding:"4px 12px",display:"flex",alignItems:"center",gap:6}}>
            <span style={{fontSize:9,fontFamily:mn,color:G,fontWeight:700}}>3%</span>
            <span style={{fontSize:8,color:DM,fontFamily:mn}}>protocol fee</span>
            {dealing&&<div style={{width:4,height:4,borderRadius:"50%",background:G,boxShadow:"0 0 6px "+G,animation:"pulse .5s ease-in-out infinite"}}/>}
          </div>
          <div style={{width:2,height:16,background:dealing?G:BD,transition:"all .3s",boxShadow:dealing?"0 0 8px "+G:"none"}}/>
          <div style={{fontSize:14,color:dealing?G:DM,transition:"all .3s"}}>‚Üì</div>
        </div>

        {/* OWNER WALLET BOX */}
        <div style={{background:"#0f1a12",border:"1px solid "+G+"40",borderRadius:12,padding:14,boxShadow:dealing?"0 0 20px "+G+"15":"none",transition:"all .3s"}}>
          <div style={{display:"flex",alignItems:"center",gap:8,marginBottom:6}}>
            <div style={{width:28,height:28,borderRadius:14,background:G+"30",border:"1px solid "+G+"60",display:"flex",alignItems:"center",justifyContent:"center",fontSize:14}}>üëë</div>
            <div>
              <div style={{fontSize:10,fontWeight:700,color:G}}>Owner Wallet</div>
              <div style={{fontSize:7,color:DM,fontFamily:mn}}>0x0c8B...223d ¬∑ Base</div>
            </div>
          </div>
          <div style={{fontSize:28,fontWeight:800,color:G,fontFamily:mn,lineHeight:1,transition:"all .3s",textShadow:dealing?"0 0 12px "+G+"60":"none"}}>{"$"+pr.toFixed(2)}</div>
          <div style={{fontSize:8,color:DM,fontFamily:mn,marginTop:4}}>3% of every settlement ‚Üí your wallet</div>
          {dealing&&(
            <div style={{marginTop:8,padding:"5px 8px",background:G+"10",borderRadius:6,display:"flex",alignItems:"center",gap:6}}>
              <div style={{width:4,height:4,borderRadius:"50%",background:G,boxShadow:"0 0 6px "+G,animation:"pulse .3s ease-in-out infinite"}}/>
              <span style={{fontSize:8,fontFamily:mn,color:G}}>Receiving funds...</span>
            </div>
          )}
        </div>

        {/* STATS */}
        <div style={{background:CD,border:"1px solid "+BD,borderRadius:12,padding:12}}>
          <div style={{display:"flex",justifyContent:"space-between",marginBottom:6}}>
            <span style={{fontSize:8,color:DM,fontFamily:mn}}>Settlements</span>
            <span style={{fontSize:8,color:TX,fontFamily:mn,fontWeight:700}}>{sc}</span>
          </div>
          <div style={{display:"flex",justifyContent:"space-between",marginBottom:6}}>
            <span style={{fontSize:8,color:DM,fontFamily:mn}}>User earned</span>
            <span style={{fontSize:8,color:G,fontFamily:mn,fontWeight:700}}>{"$"+ea.toFixed(2)}</span>
          </div>
          <div style={{display:"flex",justifyContent:"space-between",marginBottom:6}}>
            <span style={{fontSize:8,color:DM,fontFamily:mn}}>Owner collected (3%)</span>
            <span style={{fontSize:8,color:G,fontFamily:mn,fontWeight:700}}>{"$"+pr.toFixed(2)}</span>
          </div>
          <div style={{display:"flex",justifyContent:"space-between"}}>
            <span style={{fontSize:8,color:DM,fontFamily:mn}}>Verify: 3% of user</span>
            <span style={{fontSize:8,color:DM,fontFamily:mn,fontWeight:700}}>{"$"+(ea*0.03).toFixed(2)}</span>
          </div>
        </div>

        {/* HOW IT WORKS */}
        <div style={{background:G+"08",border:"1px solid "+G+"20",borderRadius:10,padding:10}}>
          <div style={{fontSize:8,fontFamily:mn,color:G,marginBottom:4,fontWeight:700}}>EVERY SETTLEMENT</div>
          <div style={{fontSize:8,color:DM,fontFamily:mn,lineHeight:1.7}}>
            Agent pays ‚Üí Smart Contract<br/>
            ‚Üí User gets their fee<br/>
            ‚Üí <span style={{color:G,fontWeight:700}}>3% ‚Üí Owner Wallet</span><br/>
            ‚Üí Agent gets remainder<br/>
            All on-chain ¬∑ Immutable ¬∑ Base L2
          </div>
        </div>

        <div style={{display:"flex",gap:6}}>
          {[{l:"COSS",s:"Open Source"},{l:"3%",s:"Hardcoded"},{l:"Base",s:"ID: 8453"}].map((x,i)=>(
            <div key={i} style={{flex:1,textAlign:"center",background:CD,border:"1px solid "+BD,borderRadius:8,padding:"5px 2px"}}>
              <div style={{fontSize:11,fontWeight:800,color:G,fontFamily:mn}}>{x.l}</div>
              <div style={{fontSize:6,color:"#fff",fontFamily:mn,textTransform:"uppercase"}}>{x.s}</div>
            </div>
          ))}
        </div>
        <div style={{fontSize:7,color:DM+"80",fontFamily:mn,textAlign:"center"}}>prmission.com</div>
      </div>
    </div>
  );
}

ReactDOM.createRoot(document.getElementById("root")).render(<App/>);
</script>
</body>
</html>
